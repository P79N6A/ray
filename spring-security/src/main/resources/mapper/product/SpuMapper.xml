<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- Mybatis mapper for product_spu  Auto generated by fms-mybatis-generator -->
<mapper namespace="com.rongyi.hla.mapper.product.SpuMapper">
    <resultMap id="product_spu" type="com.rongyi.model.product.ProductSpu">
        <id property="id" column="spu_id" javaType="int" jdbcType="INTEGER"/>
        <result property="spuCode" column="spu_spu_code" javaType="string" jdbcType="VARCHAR"/>
        <result property="name" column="spu_name" javaType="string" jdbcType="VARCHAR"/>
        <result property="price" column="spu_price" javaType="int" jdbcType="INTEGER"/>
        <result property="notes" column="spu_notes" javaType="string" jdbcType="VARCHAR"/>
        <result property="state" column="spu_state" javaType="boolean" jdbcType="TINYINT"/>
        <result property="image" column="spu_image" javaType="string" jdbcType="VARCHAR"/>
        <result property="originPlace" column="spu_origin_place" javaType="string" jdbcType="VARCHAR"/>
        <result property="material" column="spu_material" javaType="string" jdbcType="VARCHAR"/>
        <result property="createDate" column="spu_create_date" javaType="date" jdbcType="DATE"/>
        <result property="updateDate" column="spu_update_date" javaType="date" jdbcType="DATE"/>
    </resultMap>

    <sql id="sqlproduct_spuColumns">
		spu_.id AS spu_id,
		spu_.spu_code AS spu_spu_code,
		spu_.name AS spu_name,
		(spu_.price)/100 AS spu_price,
		spu_.notes AS spu_notes,
		spu_.state AS spu_state,
		spu_.origin_place AS spu_origin_place,
		spu_.material AS spu_material,
		spu_.image AS spu_image,
		spu_.create_date AS spu_create_date,
		spu_.update_date AS spu_update_date
	</sql>


    <select id="get" parameterType="string" resultMap="product_spu">
        SELECT
        <include refid="sqlproduct_spuColumns"/>
        FROM product_spu spu_
        WHERE spu_.spu_code = #{spuCode,jdbcType=VARCHAR}
    </select>


    <select id="list" resultMap="product_spu">
        SELECT
        <include refid="sqlproduct_spuColumns"/>
        FROM product_spu spu_
    </select>


    <select id="selectForPage" parameterType="com.rongyi.dto.query.SpuQueryDTO" resultMap="product_spu">
        SELECT
        <include refid="sqlproduct_spuColumns"/>
        FROM product_spu AS spu_
        <where>
            <if test="name != null and name != ''">and spu_.`name` like "%"#{name,jdbcType=VARCHAR}"%"</if>
            <if test="state != null and state != ''">and spu_.state =#{state,jdbcType=TINYINT}</if>
        </where>
        ORDER BY update_date DESC
        LIMIT #{offSet},#{pageSize};
    </select>


    <select id="selectPageCount" parameterType="com.rongyi.dto.query.SpuQueryDTO" resultType="java.lang.Integer">
        SELECT COUNT(spu_.id) FROM product_spu spu_
        <where>
            <if test="name != null and name != ''">spu_.`name` like "%"#{name,jdbcType=VARCHAR}"%"</if>
            <if test="state != null and state != ''">and spu_.state =#{state,jdbcType=TINYINT}</if>
        </where>
    </select>


    <!--根据分组编码来查询数据-->
    <select id="listByGroupCode" parameterType="com.rongyi.dto.query.SpuQueryDTO" resultMap="product_spu">
        SELECT
        <include refid="sqlproduct_spuColumns"/>
        FROM product_spu AS spu_
        LEFT JOIN group_spu AS group_spu_ ON group_spu_.spu_code = spu_.spu_code
        <where>
            <if test="name != null and name != ''">and spu_.`name` like "%"#{name,jdbcType=VARCHAR}"%"</if>
            <if test="groupCode != null and groupCode != ''">and group_spu_.group_code =#{groupCode,jdbcType=VARCHAR}
            </if>
            <if test="state != null and state != ''">and spu_.state =#{state,jdbcType=TINYINT}</if>
        </where>
        ORDER BY update_date DESC
        LIMIT #{offSet},#{pageSize};
    </select>


    <select id="getPageCountByGroupCode" parameterType="com.rongyi.dto.query.SpuQueryDTO"
            resultType="java.lang.Integer">
        SELECT COUNT(spu_.id)
        FROM product_spu AS spu_
        LEFT JOIN group_spu AS group_spu_ ON group_spu_.spu_code = spu_.spu_code
        <where>
            <if test="name != null and name != ''">and spu_.`name` like "%"#{name,jdbcType=VARCHAR}"%"</if>
            <if test="groupCode != null and groupCode != ''">and group_spu_.group_code =#{groupCode,jdbcType=VARCHAR}
            </if>
            <if test="state != null and state != ''">and spu_.state =#{state,jdbcType=TINYINT}</if>
        </where>

    </select>


    <select id="selectAll" resultMap="product_spu">
        SELECT
        <include refid="sqlproduct_spuColumns"/>
        FROM product_spu spu_
    </select>


    <select id="getTotalCount" resultType="java.lang.Integer">
        SELECT       COUNT(id)       FROM    product_spu
    </select>

    <insert id="save" parameterType="com.rongyi.model.product.ProductSpu" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO product_spu (
		    spu_code,
			`name`,
			price,
			notes,
			state,
			image,
			create_date,
			update_date
		)
        VALUES (
			#{spuCode,jdbcType=VARCHAR},
			#{name,jdbcType=VARCHAR},
			#{price,jdbcType=INTEGER}*100,
			#{notes,jdbcType=VARCHAR},
			#{state,jdbcType=TINYINT},
			#{image,jdbcType=VARCHAR},
			now(),
			now()
		)
	</insert>

    <insert id="saveGroupSpu" parameterType="com.rongyi.model.product.GroupSpu" useGeneratedKeys="true"
            keyProperty="id">
		INSERT INTO group_spu (
		    spu_code,
			group_code,
			group_name
		)
        VALUES (
			#{spuCode,jdbcType=VARCHAR},
			#{groupCode,jdbcType=VARCHAR},
			#{groupName,jdbcType=VARCHAR}
		)
	</insert>

    <update id="update" parameterType="com.rongyi.model.product.ProductSpu">
        UPDATE product_spu
        <trim prefix="set" suffixOverrides=",">
            <if test="state != null">state = #{state} ,</if>
            <if test="originPlace != null ">origin_place = #{originPlace,jdbcType=VARCHAR} ,</if>
            <if test="material != null ">material = #{material,jdbcType=VARCHAR} ,</if>
            update_date = now(),
        </trim>
        WHERE spu_code = #{spuCode,jdbcType=VARCHAR}
    </update>

    <update id="updateGroupSpu" parameterType="com.rongyi.model.product.GroupSpu">
        UPDATE group_spu
        <trim prefix="set" suffixOverrides=",">
            <if test="spuCode != null and spuCode!=null">spu_code = #{spuCode,jdbcType=VARCHAR} ,</if>
            <if test="groupCode != null and groupCode!=null">group_code = #{groupCode,jdbcType=VARCHAR} ,</if>
            <if test="groupName != null and groupName!=null">group_name = #{groupName,jdbcType=VARCHAR} ,</if>
        </trim>
        WHERE spu_code = #{spuCode,jdbcType=VARCHAR}
    </update>
</mapper>
